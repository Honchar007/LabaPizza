<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="style.css">
    <title>Document</title>
</head>

<body>

    <nav class="navbar navbar-expand-sm  navbar-dark bg-dark">
        <div class="container row">
            <a class="col-auto navbar-brand" href="#">
                <img src="pizzahut-logo.png" width="50" height="50" alt="pizza hut"> Pizza Hut
            </a>
            <div class="col-auto navbar-nav " id="collapsibleNavId">
                <ul class="nav justify-content-center">
                    <li class="nav-item">
                        <a class="nav-link " href="#home">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#"></a>
                    </li>

                    <li>
                        <div class="btn-group">
                            <a type="button" href="#products" class="btn btn-secondary">Products</a>
                            <button type="button" class="btn btn-secondary dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="sr-only"></span>
                            </button>
                            <div class="dropdown-menu">
                                <a class="dropdown-item" href="#products/cheezepizza">Cheeze Pizza</a>
                                <a class="dropdown-item" href="#products/meatpizza">Meat Pizza</a>
                                <a class="dropdown-item" href="#products/brandpizza">Brand Pizza</a>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
            <div class="col"></div>
            <div class=" navbar-nav justify-content-center bg-secondary rounded" id="">
                <a class="nav-link align-self-center" href="#cart" id='totalPrice'>0.00</a>
                <a class="nav-link align-self-center" href="#cart" id="count">0 шт.</a>
                <a class="nav-link" href="#cart">
                    <img src="cart-logo.jpg" width="50" height="50" alt="Cart">
                </a>

            </div>

        </div>
    </nav>
    <a href="#sale">
        <div href="" class="slider">
            <div class="slides">
                <div id="slide-1">
                    <img src="1.jpg" alt="">
                </div>
                <div id="slide-2">
                    <img src="2.png" alt="">

                </div>
                <div id="slide-3">
                    <img src="3.jpg" alt="">

                </div>
            </div>
        </div>
    </a>
    <div id='mainReccomend' class="container-fluid text-decoration-none">

    </div>

    <div class=""></div>

    <footer class="">
        <div class="foot container-fluid bg-dark text-light mt-4">
            <div class="row">
                <div class="col nav flex-column">
                    <div class="nav-link" href="#!">Coц. сети</div>
                    <div class="nav-link" href="#!">Instagram: pizzahut </div>
                    <div class="nav-link" href="#!">Facebook: pizzaHUT </div>
                </div>
                <div class="col nav flex-column">
                    <div class="nav-link" href="#!">About us</div>
                    <a class="nav-link" href="#sale">Sales </a>
                    <a class="nav-link" href="#home">Home </a>
                </div>
                <div class="col nav flex-column">
                    <div class="nav-link" href="#!">Наши контакты</div>
                    <div class="nav-link" href="#!">+3809999999 </div>
                    <div class="nav-link" href="#!">+3804444444 </div>
                </div>
            </div>
        </div>
    </footer>
    <script src="Post.js"></script>
    <script>
        function addToCartGlobal(cnt) {
            var e = document.getElementById("count");
            e.innerText = (parseInt(e.innerText, 10) + 1) + " шт.";
            e = document.getElementById("totalPrice");
            var price = document.getElementById("price" + cnt);
            var normal = parseFloat(e.innerText, 10) + parseFloat(price.innerText, 10) + '';
            e.innerText = normal.split('.')[0] + '.' + normal.split('.')[1].substring(0, 2);
            cart.totalprice = e.innerText;
            if (cart.items.indexOf(cnt) == -1) {
                cart.items.push(cnt);
                cart.countitems.push(1);
                cart.allcount++;
            } else {
                cart.countitems[cart.items.indexOf(cnt)]++;
                cart.allcount++;
            }
            localStorage.clear;
            localStorage.setItem('cart', JSON.stringify(cart));
        }

        var cart = {
            totalprice: 0,
            items: [],
            countitems: [],
            allcount: 0
        }

        function AddTochart(num) {

            var e = document.getElementById("count");
            e.innerText = (parseInt(e.innerText, 10) + 1) + " шт.";
            e = document.getElementById("totalPrice");
            var price = document.getElementById("price");
            var normal = parseFloat(e.innerText, 10) + parseFloat(price.innerText, 10) + '';
            e.innerText = normal.split('.')[0] + '.' + normal.split('.')[1].substring(0, 2);
            cart.totalprice = e.innerText;
            if (cart.items.indexOf(num) == -1) {

                cart.items.push(num);
                cart.countitems.push(1);
                cart.allcount++;
            } else {


                cart.countitems[cart.items.indexOf(num)]++;
                cart.allcount++;
            }
            localStorage.clear;
            localStorage.setItem('cart', JSON.stringify(cart));
        }

        function isValidPhone(myPhone) {
            return /^\+\d{12}$/.test(myPhone);
        }

        function validPhone() {
            var val = document.getElementById('formInput3').value;
            var elem = document.getElementById("formInput3");

            if (isValidPhone(val)) {
                elem.classList.remove('not-correct');
                return true;
            } else {
                elem.classList.add('not-correct');
                return false;
            }
        }

        function isValidMail(myMail) {
            return /^[\w-\.]+@[\w-]+\.[a-z]{2,4}$/i.test(myMail);
        }

        function validMail() {
            var val = document.getElementById('formInput4').value;
            var elem = document.getElementById("formInput4");
            if (isValidMail(val)) {
                elem.classList.remove('not-correct');
                return true;
            } else {
                elem.classList.add('not-correct');
                return false;
            }
        }
        async function Order() {
            let cart = localStorage.getItem('cart');
            var userid = document.getElementById("formInput1").value;
            var new_order = '0000' + Math.random() * 100;
            var pizzas = cart.items;
            var counts = cart.countitems;
            const url = 'https://my-json-server.typicode.com/honchar007/test-json/orders';
            const data = {
                username: userid,
                order: new_order,
                whatpizza: pizzas,
                howmuch: counts
            };

            try {
                const orderId = (await fetch(url, {
                        method: 'POST', // или 'PUT'
                        body: JSON.stringify(data), // данные могут быть 'строкой' или {объектом}!

                    }).then((response) => response.json())
                    .catch(e => console.log(e))).id;
                console.log(orderId);
                window.location.hash = window.location.hash.split('#')[0] + "#" + orderId;

            } catch (error) {
                console.error('Ошибка:', error);
            }
        }

        function validPost() {
            if (validMail() && validPhone()) {
                Order();

                localStorage.clear();
                var e = document.getElementById("count");
                e.innerText = "0 шт.";
                e = document.getElementById("totalPrice");
                e.innerText = '0.00';
            }
        }
    </script>

    <script src="index.js" type="module"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js">
        $(document).ready(function() {
            $('.preloader, .overlay').fadeOut();
        });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

</body>

</html>